package com.qualitymap.dao.impl;

import java.util.List;
import java.util.Map;

import org.hibernate.SQLQuery;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.transform.Transformers;

import com.qualitymap.dao.ServicequalityOrgidPingDao;
import com.qualitymap.vo.OverviewKpi;

/**
 * 测试报告ping
 * @author zhaoqh
 *
 */
public class ServicequalityOrgidPingDaoImpl implements
		ServicequalityOrgidPingDao {

	private SessionFactory sessionFactory;

	public void setSessionFactory(SessionFactory sessionFactory) {
		this.sessionFactory = sessionFactory;
	}

	public Session getSession() {
		return sessionFactory.getCurrentSession();
	}
	
	/**
	 * 获取城市list
	 */
	@Override
	public List<Map<String, Object>> getCityList(String month,String groupid) {
		String sql = " SELECT DISTINCT orgname  FROM servicequality_orgid_ping WHERE `month` ='" + month + "'  and groupid = '"+groupid+"' ";

		List<Map<String, Object>> queryList = this.getSession().createSQLQuery(sql).setResultTransformer(Transformers.ALIAS_TO_ENTITY_MAP).list();
		return queryList;
	}
	/**
	 * 根据groupid获取有效样本
	 */
	@Override
	public String getValidSampleNum(String month, String groupid) {
		String sql = "select IFNULL(sum(ping_test_times),0) ping_test_times from servicequality_orgid_ping where  month= '"+month+"' and groupid = '"+groupid+"'";
		SQLQuery query = this.getSession().createSQLQuery(sql);    
	    String ping_test_times = query.uniqueResult().toString(); 
		return ping_test_times;
	}
}
